sap.ui.define(["sap/ui/core/Control"],function(e){"use strict";return e.extend("dirk.gears.control.GearGraphics",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"1000px"},height:{type:"sap.ui.core.CSSSize",defaultValue:"200px"},cadence:{type:"int",defaultValue:0},circumference:{type:"int",defaultValue:0},circumference2:{type:"int",defaultValue:0},tireName:{type:"string",defaultValue:""},chainrings:{type:"float[]",defaultValue:[]},cogs:{type:"float[]",defaultValue:[]},chainrings2:{type:"float[]",defaultValue:[]},cogs2:{type:"float[]",defaultValue:[]},hubType:{type:"string",defaultValue:"DERS"},hubName:{type:"string",defaultValue:""},hubRatios:{type:"float[]",defaultValue:[1]},hubRatios2:{type:"float[]",defaultValue:[1]},dsplValues:{type:"string",defaultValue:"teeth"},minHubRatio:{type:"float"},maxChainAngle:{type:"float",defaultValue:0},unitsIndex:{type:"int",defaultValue:0},selected:{type:"boolean",group:"Data",defaultValue:false}},aggregations:{},events:{select:{parameters:{selected:{type:"boolean"}}}}},init:function(){},onclick:function(e){this.fireSelect()},setCadence:function(e){this.setProperty("cadence",e,true);this.invalidate()},setCircumference:function(e){this.setProperty("circumference",e,true);this.invalidate()},setMaxChainAngle:function(e){this.setProperty("maxChainAngle",e,true);this.invalidate()},setChainrings:function(e){this.setProperty("chainrings",e,true);this.invalidate()},setCogs:function(e){this.setProperty("cogs",e,true);this.invalidate()},setHubType:function(e){this.setProperty("hubType",e,true);this.invalidate()},setHubRatios:function(e){this.setProperty("hubRatios",e,true);this.invalidate()},setDsplValues:function(e){this.setProperty("dsplValues",e,true);this.invalidate()},setSelected:function(e){e=!!e;this.setProperty("selected",e,true);return this},repaint:function(){this.invalidate()},reset:function(){},paintScales:function(e){function t(e,t,i,l){if(l>=e&&l<=t){if(e>0){return Math.log(l/e)/Math.log(t/e)*i}else{return Math.log(l)/Math.log(t)*i}}else{return 0}}function i(e,t,i,l,a,n,r,s,o){switch(t){case"ratio":e.fillText(l.toPrecision(3),s,o-16);break;case"development":e.fillText((l*a/1e3).toPrecision(3),s,o-16);break;case"gearInches":e.fillText((l*a/25.4/3.1415927).toPrecision(3),s,o-16);break;case"speed":e.fillText((l*a/1e3*n*r).toPrecision(3),s,o-16);break;default:}}var l=[5.5,5.5,5.5,5.5,5.3,5,5,4.8,4.34,3.95,3.9,3.5,3,3,3,3,3,3,3,3];var a=5;e.beginPath();var n=e.canvas.width;var r=e.canvas.height;var s=this.getChainrings().sort(function(e,t){return e-t});var o=this.getCogs().sort(function(e,t){return e-t});var h=this.getHubRatios();var f=this.getChainrings2().sort(function(e,t){return e-t});var u=this.getCogs2().sort(function(e,t){return e-t});var g=this.getHubRatios2();var c=s[0]/o[o.length-1]*h[0];var d=s[s.length-1]/o[0]*h[h.length-1];var v=f[0]/u[u.length-1]*g[0];var p=f[f.length-1]/u[0]*g[g.length-1];var T=this.getCircumference();var y=this.getCircumference2();var x=this.getCadence();var b=this.getMaxChainAngle();var m=this.getModel("i18n").getResourceBundle();e.fillStyle="#FFFFFF";e.fillRect(0,0,n,r);e.textAlign="center";for(var S=0;S<s.length;S++){var P=(r-20)/(s.length+1)*(S+1)+.5;e.strokeStyle="#e34c26";e.beginPath();e.lineWidth=1;e.moveTo(0,P);e.lineTo(0+n,P);e.stroke();e.closePath();e.beginPath();e.fillStyle="#e34c26";e.arc(0+n-20,P,10,0,Math.PI*2,true);e.closePath();e.fill();e.fillStyle="#FFFFFF";e.font="bold 12px sans-serif";e.fillText(s[S].toString(),0+n-20,P+4)}e.strokeStyle="#000000";e.fillStyle="#000000";e.lineWidth=1;e.font="12px sans-serif";e.textAlign="center";var M=.5;var C=.5;var V=Math.min(c*this.getCircumference()/1e3*.8,v*this.getCircumference2()/1e3*.8);var F=Math.max(d*this.getCircumference()/1e3*1.15,p*this.getCircumference2()/1e3*1.15);e.beginPath();if(this.getUnitsIndex()===0){var k=Math.floor(V*10);var A=Math.floor(F*10+1);e.textAlign="left";e.fillText(m.getText("development")+"/m",10,21);e.textAlign="center";for(S=k;S<=A;S++){var R=M+Math.round(t(V,F,n,S/10));if(R>M){e.moveTo(R,C);if(S%10===0){e.lineTo(R,C+10);if(R>80){e.fillText(S/10,R,C+20)}}else if(S%5===0){e.lineTo(R,C+8)}else{e.lineTo(R,C+5)}}}}else{var E=V*100/2.54/Math.PI;var H=F*100/2.54/Math.PI;var I=Math.floor(E);var D=Math.floor(H+1);e.textAlign="left";e.fillText("Gear Inches",10,21);e.textAlign="center";for(S=I;S<=D;S++){R=M+Math.round(t(E,H,n,S));if(R>M){e.moveTo(R,C);if(S%10===0){e.lineTo(R,C+10);if(R>80){e.fillText(S,R,C+20)}}else if(S%5===0){e.lineTo(R,C+8)}else{e.lineTo(R,C+5)}}}}e.stroke();e.closePath();var w=this.getUnitsIndex()===0?60/1e3:60/1609.3;var N=V*x*w;var G=F*x*w;var U=Math.round(N+.5);var B=Math.round(G-.5);e.textAlign="left";e.fillText(this.getUnitsIndex()===0?"km/h":"mph",10,r-30+20);e.textAlign="center";e.beginPath();e.moveTo(M,C+r-30);e.lineTo(M+n,C+r-30);for(S=U;S<=B;S++){R=M+Math.round(t(N,G,n,S));if(R>M){e.moveTo(R,C+r-30);if(S%5===0){e.lineTo(R,C+r-30+10);if(R>40){e.fillText(S,R,C+r-30+20)}}else{e.lineTo(R,C+r-30+5)}}}e.stroke();e.closePath();var W=[];var z=[];e.fillStyle="#000000";e.font="bold 11px sans-serif";var $=12;for(S=0;S<s.length;S++){P=Math.round((r-20)/(s.length+1)*(S+1))+C-10.5;z[S]=new Array(o.length);for(var q=0;q<o.length;q++){if(s[S]*o[q]!==0){R=M+Math.round(t(V,F,n,s[S]/o[q]*T/1e3));if(R>M+12){e.beginPath();e.moveTo(R-$,P-$);e.lineTo(R+$,P-$);e.lineTo(R,P+$);e.lineTo(R-$,P-$);var j=Math.abs((S-(s.length-1)/2)*a-((o.length-1)/2-q)*l[o.length-1]);z[S][q]=Math.asin(j/430)/Math.PI*180<b;e.fillStyle=!z[S][q]||this.getHubType()!=="DERS"?"#E8E8E8":"#000000";e.fill();e.closePath();e.fillStyle="rgb(200,200,200)";e.fillText(o[q],R,P-1);e.fillStyle="rgb(00,00,00)";if(this.getHubType()==="DERS"){switch(this.getDsplValues()){case"ratio":e.fillText((s[S]/o[q]).toPrecision(3),R,P-16);break;case"development":e.fillText((s[S]/o[q]*T/1e3).toPrecision(3),R,P-16);break;case"gearInches":e.fillText((s[S]/o[q]*T/25.4/3.1415927).toPrecision(3),R,P-16);break;case"speed":e.fillText((s[S]/o[q]*T/1e3*x*w).toPrecision(3),R,P-16);break;case"cogs":e.fillText(o.length-q,R,P-16);break;default:}}if(this.getHubType().slice(0,2)==="NU"){var J=M+Math.round(t(V,F,n,s[S]/o[q]*h[0]*T/1e3));var K=M+Math.round(t(V,F,n,s[S]/o[q]*h[1]*T/1e3));e.beginPath();e.moveTo(J,P-$);e.lineTo(K,P-$);e.lineTo(K,P+$-2);e.lineTo(J,P+$-2);e.lineTo(J,P-$);e.fillStyle="#000000";e.fill();e.closePath();i(e,this.getDsplValues(),q,s[S]/o[q]*h[0],T,x,w,J,P);i(e,this.getDsplValues(),q,s[S]/o[q]*h[1],T,x,w,K,P);e.fillStyle="rgb(200,200,200)";e.fillText(o[q],R,P-1)}else if(this.getHubType()!=="DERS"){for(var L=0;L<h.length;L++){var O=M+Math.round(t(V,F,n,s[S]/o[q]*h[L]*T/1e3));e.beginPath();e.moveTo(O-$,P-$);e.lineTo(O+$,P-$);e.lineTo(O,P+$);e.lineTo(O-$,P-$);e.fillStyle="#000000";e.fill();e.closePath();i(e,this.getDsplValues(),q,s[S]/o[q]*h[L],T,x,w,O,P)}e.fillStyle="rgb(200,200,200)";e.fillText(o[q],R,P-1)}}if(z[S][q]){if(this.getHubType()!=="DERS"){for(L=0;L<h.length;L++){W.push(s[S]/o[q]*h[L])}}else{W.push(s[S]/o[q])}}}}}e.fillStyle="rgb(150,150,150)";e.textAlign="left";if(this.getHubType()!=="DERS"){e.fillText(this.getHubName(),10,140);if(s[0]/o[o.length-1]<this.getMinHubRatio()){e.fillStyle="#e34c26";e.fillText(m.getText("highTorque"),10,80);e.fillStyle="rgb(150,150,150)";e.textAlign="left"}}else{e.fillText(m.getText("capacity")+": "+(s[s.length-1]-s[0]+o[o.length-1]-o[0]),10,140)}W.sort(function(e,t){return e-t});e.beginPath();e.fillText(this.getTireName(),10,110);e.fillRect(M,r-50,n,16);e.fillStyle="#FFFFFF";e.strokeStyle="#FFFFFF";e.fillText(m.getText("gearStep"),10,r-38);e.fillText(Math.round(W[W.length-1]/W[0]*100)+"%",M+n-50,r-38);e.textAlign="center";for(S=0;S<W.length;S++){R=M+Math.round(t(V,F,n,W[S]*T/1e3));e.moveTo(R,r-50);e.lineTo(R,r-35);if(S>0){var Q=Math.round(W[S]/W[S-1]*100-100);if(Q>1){var X=M+Math.round(t(V,F,n,W[S-1]*T/1e3));e.fillText(Q,(R+X)/2,r-38)}}}e.stroke();e.closePath()},onThemeChanged:function(){this.invalidate()},onAfterRendering:function(){var e=this.$().width();var t=this.$().height();var i=document.getElementById(this.getId()).getElementsByClassName("gearCanvas")[0];i.width=e;i.height=t;var l=i.getContext("2d");this.paintScales(l)},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("gearGraphics");e.style("width",t.getWidth());e.style("height",t.getHeight());e.openEnd();e.openStart("div");e.attr("id","gearChart");e.class("canvasArea");e.openEnd();e.openStart("canvas");e.class("gearCanvas");e.style("border","1px solid #000000");e.openEnd();e.close("canvas");e.close("div");e.close("div")}}})});