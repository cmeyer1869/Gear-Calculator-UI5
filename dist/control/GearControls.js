sap.ui.define(["sap/ui/core/Control","sap/m/Label"],function(e,t){"use strict";return e.extend("dirk.gears.control.GearControls",{metadata:{properties:{value:{type:"float",defaultValue:0},nsprockets:{type:"int",defaultValue:0},minteeth:{type:"int",defaultValue:0},maxteeth:{type:"int",defaultValue:0},image:{type:"string",defaultValue:""},width:{type:"sap.ui.core.CSSSize",defaultValue:"1000px"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100px"},sprocketType:{type:"string",defaultValue:""},sprockets:{type:"float[]",defaultValue:[]},widthPixels:{type:"int",defaultValue:0}},aggregations:{_label:{type:"sap.m.Label",multiple:false,visibility:"hidden"},_label2:{type:"sap.m.Label",multiple:false,visibility:"hidden"}},events:{change:{parameters:{value:{type:"int"},sprockets:{type:"float[]"}}}}},init:function(){this.setAggregation("_label",new t({text:this.getValue()}).addStyleClass("sapUiSmallMargin"));this.setAggregation("_label2",new t({text:this.getNsprockets()}).addStyleClass("sapUiSmallMargin"))},onThemeChanged:function(){this.invalidate()},repaint:function(){this.invalidate()},setValue:function(e){this.setProperty("value",e,true);this.getAggregation("_label").setText(e)},reset:function(){var e=this.getModel("i18n").getResourceBundle();this.setValue(0);this.getAggregation("_label").setDesign("Standard");this.getAggregation("_label").setText(e.getText("productRatingLabelInitial"));this.setNsprockets(0);this.getAggregation("_label2").setDesign("Standard");this.getAggregation("_label2").setText(e.getText("productRatingLabelInitial"))},onBeforeRendering:function(){if(this.getDomRef()){var e=document.getElementById(this.getId()).getElementsByClassName(this.getSprocketType());for(var t=0;t<e.length;t++){e[t].removeEventListener("touchstart",this.fMouseDown);e[t].removeEventListener("mousedown",this.fMouseDown)}window.removeEventListener("touchstart",this.fMouseUp);window.removeEventListener("touchend",this.fMouseUp)}},onAfterRendering:function(){var e=100;var t=this.getDomRef().clientWidth-e;this.setWidthPixels(this.getDomRef().clientWidth-e);var i;var n;var s=this.getMinteeth();var a=this.getMaxteeth();var r=a-s+1;var o=false;var l=this;var d=0;var h=0;var u=0;var g=document.getElementById(this.getId()).getElementsByClassName(this.getSprocketType());var c=document.getElementById(this.getId()).getElementsByClassName("scaleTick");var p=document.getElementById(this.getId()).offsetLeft;for(var f=0;f<c.length;f++){c[f].style.left=e+Math.round(f*l.getWidthPixels()/(r-1))-1+"px"}var v=this.getSprockets();for(f=0;f<v.length;f++){g[f].innerHTML=v[f];g[f].innerText=v[f];g[f].style.left=e+Math.round((this.getSprockets()[f]-s)*l.getWidthPixels()/(r-1)-g[f].clientWidth/2)+"px"}function m(u){if(o){if(u.type==="mousemove"){var g=u.clientX-p-n+i.clientWidth/2}else if(u.type==="touchmove"){g=u.touches[0].clientX-p-n+i.clientWidth/2}i.style.left=Math.max(0,Math.min(e+t-i.clientWidth/2,g-i.clientWidth/2))+"px";var c=Math.round((g-e)/t*(r-1)+s);if(c>a){c=a;h=a}else if(c<s&&h>0){if(i.innerText!==""){var f=l.getSprockets();f.splice(d,1);l.setProperty("sprockets",f,true)}i.innerText="";i.innerHTML="";c=0;h=0}else if(c!==h&&c>=s){h=c;f=l.getSprockets();if(i.innerText!==""){f[d]=c}else{f.splice(d,0,s)}i.innerText=c;i.innerHTML=c;l.setProperty("sprockets",f,true);l.fireChange()}}}function y(e){o=true;i=e.currentTarget;if(e.type==="mousedown"){n=e.clientX-p-i.offsetLeft;window.addEventListener("mousemove",m,true)}else if(e.type==="touchstart"){n=e.touches[0].clientX-p-i.offsetLeft;window.addEventListener("touchmove",m,true)}for(f=0;f<l.getSprockets().length;f++){if(l.getSprockets()[f]===Number(i.innerText)){d=f}}}function x(t){if(o){window.removeEventListener("mousemove",m,true);window.removeEventListener("touchmove",m,true);var a=t.clientX-p-n+i.clientWidth/2;var d=Math.round((a-e)/l.getWidthPixels()*(r-1)+s);if(d<s){i.style.left=0}else{i.style.left=Math.round(Math.min(e+l.getWidthPixels()-i.clientWidth/2,e+(d-s)*l.getWidthPixels()/(r-1)-i.clientWidth/2))+"px"}o=false}}for(f=0;f<g.length;f++){g[f].addEventListener("touchstart",y);g[f].addEventListener("mousedown",y)}this.fMouseDown=y;window.addEventListener("touchend",x,true);window.addEventListener("mouseup",x,true);this.fMouseUp=x},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("gearControl");e.style("width",t.getWidth());e.style("height",t.getHeight());var i=t.getMaxteeth()-t.getMinteeth()+1;var n=t.getSprocketType();e.openEnd();for(var s=0;s<i;s++){e.openStart("div");e.class("scaleTick");e.openEnd();e.close("div")}for(var a=0;a<t.getNsprockets();a++){e.openStart("div");e.class(n);e.openEnd();e.close("div")}e.close("div")}}})});